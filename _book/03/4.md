# 四、介质访问控制

传输数据使用的两种链路

- 点对点链路：两个相邻节点通过一个链路相连，没有第三者，应用：PPP协议，常用于广域网
- 广播式链路：所有主机共享通信介质，应用：早期的总线以太网、无线局域网，常用于局域网

## 4.1 信道划分介质访问控制

信道划分介质访问控制将使用介质的每个设备与来自同一通信信道上的其他设备的通信隔离开来，把时域和频域资源合理地分配给网络上的设备。

当传输介质的带宽超过传输单个信号所需的带宽时，人们就通过在一条介质上同时携带多个传输信号的方法来提高传输系统的利用率，这就是所谓的多路复用，也是实现信道划分介质访问控制的途径。多路复用技术把多个信号组合在一条物理信道上进行传输，使多个计算机或终端设备共享信道资源，提高了信道的利用率。信道划分的实质就是通过分时、分频、分码等方法把原来的一条广播信道,逻辑上分为几条用于两个结点之间通信的互不干扰的子信道，实际上就是把广播信道转变为点对点信道。

### 4.1.1 频分多路复用FDM

频分多路复用是一种将多路基带信号调制到不同频率载波上，再叠加形成一个复合信号的多路复用技术。在物理信道的可用带宽超过单个原始信号所需带宽的情况下，可将该物理信道的总带宽分割成若千与传输单个信号带宽相同(或略宽)的子信道，每个子信道传输一种信号，这就是频分多路复用。

每个子信道分配的带宽可不相同，但它们的总和必须不超过信道的总带宽。在实际应用中，为了防止子信道之间的千扰，相邻信道之间需要加入“保护频带”。频分多路复用的优点在于充分利用了传输介质的带宽，系统效率较高;由于技术比较成熟,实现也较容易。

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-f8765facacbf1d77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 4.1.2 时分多路复用TDM

时分多路复用是将一条物理信道按时间分成若干时间片，轮流地分配给多个信号使用。每个时间片由复用的一个信号占用，而不像FDM那样，同一时间同时发送多路信号。这样，利用每个信号在时间上的交叉，就可以在一条物理信道上传输多个信号。

就某个时刻来看,时分多路复用信道上传送的仅是某一对设备之间的信号:就某段时间而言,传送的是按时间分割的多路复用信号。但由于计算机数据的突发性，一个用户对已经分配到的子信道的利用率一般不高。统计时分多路复用(STDM，又称异步时分多路复用)是TDM 的一种改进，它采用STDM帧，STDM帧并不固定分配时隙，面按需动态地分配时隙，当终端有数据要传送时，才会分配到时间片，因此可以提高线路的利用率。例如，线路传输速率为8000b/s，4个用户的平均速率都为2000b/s，当采用TDM方式时，每个用户的最高速率为2000b/s.而在STDM方式下,每个用户的最高速率可达8000b/s.

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-47149da9ac4349da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 4.1.3 波分多路复用WDM

波分多路复用即光的频分多路复用，它在一根光纤中传输多种不同波长(频率）的光信号，由于波长（频率）不同，各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来。由于光波处于频谱的高频段，有很高的带宽，因而可以实现多路的波分复用

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-4ccca251ade8bca4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 4.1.4 码分多路复用CDM

码分多路复用是采用不同的编码来区分各路原始信号的一种复用方式。与FDM和 TDM不同,它既共享信道的频率，又共享时间。下面举一个直观的例子来理解码分复用。

实际上，更常用的名词是码分多址(Code Division Multiple Access.CDMA)，1个比特分为多个码片/芯片( chip)，每一个站点被指定一个唯一的m位的芯片序列，发送1时发送芯片序列（通常把o写成-1） 。发送1时站点发送芯片序列，发送o时发送芯片序列反码。

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-dffaeee5df747055.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

- 多个站点同时发送数据的时候，要求各个站点芯片序列相互正交，规格化内积为0。$\frac{1}{m}\sum_{i=1}^{m}{S_iT_i}=0$
- 两个向量到了公共信道上，线性相加。$S-T=(0,0-2,2,0,-2,0,2)$
- 数据分离:合并的数据和源站规格化内积。$A=S·(S-T)$,$B=T·(S-T)$

## 4.2 随机访问介质访问控制

### 4.2.1 ALOHA协议

纯ALOHA协议思想：不监听信道，不按时间槽发送，随机重发。想发就发

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-9ef114c24b14a3d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



如果发生冲突，接收方在就会检测出差错，然后不予确认，发送方在一定时间内收不到就判断发生冲突。超时后等一随机时间再重传。

时隙ALOHA协议的思想：把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送。

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-0021a1d19ec19484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



### 4.2.2 CSMA协议

载波监听多路访问协议CSMA（carrier sense multiple access）协议思想：发送帧之前，监听信道。

- CS：载波侦听/监听，每一个站在发送数据之前要检测一下总线上是否有其他计算机在发送数据。
- MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上。

#### 4.2.2.1 1-坚持CSMA

坚持指的是对于监听信道忙之后的坚持。

1-坚持CSMA思想：如果一个主机要发送消息，那么它先监听信道。

- 空闲则直接传输，不必等待。
- 忙则一直监听，直到空闲马上传输。
- 如果有冲突（一段时间内未收到肯定回复），则等待一个随机长的时间再监听，重复上述过程。

优点：只要媒体空闲，站点就马上发送，避免了媒体利用率的损失。

缺点：假如有两个或两个以上的站点有数据要发送，冲突就不可避免。

#### 4.2.2.2 非坚持CSMA

非坚持指的是对于监听信道忙之后就不继续监听。

非坚持CSMA思想：如果一个主机要发送消息，那么它先监听信道。

- 空闲则直接传输，不必等待。
- 忙则等待一个随机的时间之后再进行监听。

优点：采用随机的重发延迟时间可以减少冲突发生的可能性。

缺点：可能存在大家都在延迟等待过程中，使得媒体仍可能处于空闲状态，媒体使用率降低。

#### 4.2.2.3 p-坚持CSMA

p-坚持指的是对于监听信道空闲的处理。

p-坚持CSMA思想：如果一个主机要发送消息，那么它先监听信道。

- 空闲则以p概率直接传输，不必等待；概率1-p等待到下一个时间槽再传输。
- 忙则持续监听直到信道空闲再以p概率发送。

优点：既能像非坚持算法那样减少冲突，又能像1-坚持算法那样减少媒体空闲时间的这种方案。

缺点：发生冲突后还是要坚持把数据帧发送完，造成了浪费。

### 4.2.3 CSMA/CD协议

载波监听多点接入/碰撞检测CSMA/CD（carrier sense multiple access with collision detection）

- CS：载波侦听/监听，每一个站在发送数据之前以及发送数据时都要检测一下总线上是否有其他计算机在发送数据。
- MA：多点接入，表示许多计算机以多点接入的方式连接在一根总线上——总线型网络
- CD：碰撞检测（冲突检测），“边发送边监听”，适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据——半双工网络

CSMA/CD的工作流程：

1. 适配器从网络层获得一个分组，封装成以太网帧，放入适配器的缓存，准备发送。
2. 如果适配器侦听到信道空闲，那么它开始发送该帧。如果适配器侦听到信道忙，那么它持续侦听直至信道上没有信号能迓，然后开始发送该帧。
3. 在发送过程中，适配器持续检测信道。若--直未检测到碰撞，则顺利地把这个帧发送完毕。若检测到碰撞，则中止数据的发送，并发送一个拥塞信号，以让所有用户都知道。
4. 在中止发送后，适配器就执行指数退避算法，等待一段随机时间后返回到步骤2。

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-d80192260e757d2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

由图可知，至多在发送帧后经过时间$2\tau$就能知道所发送的帧有没有发生碰撞。因此把以太网端到端往返时间为$2\tau$称为争周期(也称冲突窗口或碰撞窗口)。

截断二进制指数规避算法：

1. 确定基本退避（推迟）时间为争用期2𝜏。
2. 定义参数k，它等于重传次数，但k不超过10，即k=min[重传次数，10]。当重传次数不超过10时，k等于重传次数；当重传次数大于10时，k就不再增大而一直等于10。
3. 从离散的整数集合$[0, 1,\cdots, 2^k-1]$中随机取出一个数r，重传所需要退避的时间就是r倍的基本退避时间，即$2r𝜏$。
4. 当重传达16次仍不能成功时，说明网络太拥挤，认为此帧永远无法正确发出，抛弃此帧并向高层报告出错。

>第一次重传，k=1，r从{0，1}选；
>重传推迟时间为0或2𝜏，在这两个时间中随机选一个；
>若再次碰撞，则在第二次重传时，k=2，r从{0，1，2，3}选；
>重传推迟时间为0或2𝜏或4𝜏或6𝜏，在这四个时间中随机选一个；
>若再次碰撞，则第三次重传时，k=3，r从{0，1，2，3，4，5，6，7}选……
>
>若连续多次发生冲突，就表明可能有较多的站参与争用信道。使用此算法可使重传需要推迟的平均时间随重传次数的增大而增大，因而减小发生碰撞的概率，有利于整个系统的稳定。

最小帧长问题：帧的传输时延至少要两倍于信号在总线中的传播时延。

{帧长（bit）} \ {数据传输速率} ≥ 2τ

最小帧长=总线传播时延*数据传输速率 *2=2τ * 数据传输速率


### 4.2.4 CSMA/CA协议

载波监听多点接入/碰撞避免CSMA/CA（carrier sense multiple access with collision avoidance）其工作原理如下

1. 发送数据前，先检测信道是否空闲。
2. 空闲则发出RTS（request to send），RTS包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息；信道忙则等待。
3. 接收端收到RTS后，将响应CTS（clear to send）。
4. 发送端收到CTS后，开始发送数据帧（同时预约信道：发送方告知其他站点自己要传多久数据）。
5. 接收端收到数据帧后，将用CRC来检验数据是否正确，正确则响应ACK帧。
6. 发送方收到ACK就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止（采用二进制指数退避算法来确定随机的推迟时间）。

CSMA/CD与CSMA/CA的异同点：

相同点：CSMA/CD与CSMA/CA机制都从属于CSMA的思路，其核心是先听再说。换言之，两个在接入信道之前都须要进行监听。当发现信道空闲后，才能进行接入。

不同点：

- 传输介质不同：CSMA/CD用于总线式以太网【有线】，而CSMA/CA用于无线局域网【无线】。
- 载波检测方式不同：因传输介质不同，CSMA/CD与CSMA/CA的检测方式也不同。CSMA/CD通过电缆中电压的变化来检测，当数据发生碰撞时，电缆中的电压就会随着发生变化；而CSMA/CA采用能量检测（ED）、载波检测（CS）和能量载波混合检测三种检测信道空闲的方式。
- CSMA/CD检测冲突，CSMA/CA避免冲突，二者出现冲突后都会进行有上限的重传。

## 4.3 轮询访问介质访问控制

轮询协议：主结点轮流“邀请”从属结点发送数据。

令牌：一个特殊格式的MAC控制帧，不含任何信息。控制信道的使用，确保同一时刻只有一个结点独占信道。每个结点都可以在一定的时间内（令牌持有时间）获得发送数据的权利，并不是无限制地持有令牌。应用于令牌环网（物理星型拓扑，逻辑环形拓扑）。采用令牌传送方式的网络常用于负载较重、通信量较大的网络中。

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-427f31d7b69ed781.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


轮询访问MAC协议/轮流协议/轮转访问MAC协议：基于多路复用技术划分资源。

- 网络负载重：共享信道效率高，且公平
- 网络负载轻：共享信道效率低

随机访问MAC协议： 用户根据意愿随机发送信息，发送信息时可独占信道带宽。**会发生冲突**

- 网络负载轻：共享信道效率高，单个结点可利用信道全部带宽
- 网络负载重：产生冲突开销

信道划分介质访问控制（MAC Multiple Access Control ）协议：既要不产生冲突，又要发送时占全部带宽。