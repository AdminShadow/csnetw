# 一、 通信基础

通信的目的是传送消息（消息：语音、文字、图像、视频等）。

## 1.1 基本概念

### 1.1.1 数据、信号和码元

数据(data)：传送信息的实体，通常是有意义的符号序列。

信号：数据的电气/电磁的表现，是数据在传输过程中的存在形式。

- 数字信号/离散信号：代表消息的参数的取值是离散的。
- 模拟信号/连续信号：代表消息的参数的取值是连续的。

码元是指用一个固定时长的信号波形（数字脉冲），代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为k进制码元，而该时长称为码元宽度。当码元的离散状态有M个时（M大于2），此时码元为M进制码元。1码元可以携带多个比特的信息量。例如，在使用二进制编码时，只有两种不同的码元，一种代表0状态，另一种代表1状态。

### 1.1.2 信源、信道与信宿

信源：产生和发送数据的源头。

信宿：接收数据的终点。

信道：信号的传输媒介。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接收信道。



![图片.png](https://upload-images.jianshu.io/upload_images/26868451-5d0d5a18d0a1719c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

从通信双方信息的交互方式看，可以有三种基本方式：

- 单工通信：只有一个方向的通信而没有反方向的交互，仅需要一条信道。
- 半双工通信/双向交替通信：通信的双方都可以发送或接收信息，但任何一方都不能同时发送和接收，需要两条信道。
- 全双工通信/双向同时通信：通信双方可以同时发送和接受信息，也需要两条信道。

数据传输方式有串行传输和并行传输：

- 串行传输：将表示一个字符的8位二进制数按由低位到高位的顺序依次发送。速度慢，费用低，适合远距离
- 并行传输：将表示一个字符的8位二进制数同时通过8条信道发送。速度快，费用高，适合近距离

数据传输方式还可以分为：

- 同步传输：在同步传输的模式下，数据的传送是以一个数据区块为单位，因此同步传输又称为区块传输。在传送数据时，需先送出1个或多个同步字符，再送出整批的数据。
- 异步传输：异步传输将比特分成小组进行传送，小组可以是8位的1个字符或更长。发送方可以在任何时刻发送这些比特组，而接收方不知道它们会在什么时候到达。传送数据时，加一个字符起始位和一个字符终止位。

### 1.1.3 速率、波特与带宽

速率也叫数据率，是指数据的传输速率，表示单位时间内传输的数据量。可以用码元传输速率和信息传输速率表示。

- 码元传输速率：别名码元速率、波形速率、调制速率、符号速率等，它表示单位时间内数字通信系统所传输的码元个数（也可称为脉冲个数或信号变化的次数），单位是波特（Baud）。1波特表示数字通信系统每秒传输一个码元

数字信号有多进制和二进制之分，但码元速率与进制数无关，只与码元长度T有关，即
$$
R_B=\frac{1}{T}(B)
$$

- 信息传输速率：别名信息速率、比特率等，表示单位时间内数字通信系统传输的二进制码元个数（即比特数），单位是比特/秒（b/s）。

若一个码元携带n bit的信息量，则M Baud的码元传输速率所对应的信息传输速率为M×n bit/s。
$$
R_b=Mlog_2 {16} (b/s)
$$


>例：若2秒内传4800个码元，码元传输速率是多少？
>
>答：2400B

带宽：

1. 模拟信号系统中：当输入的信号频率高或低到一定程度，使得系统的输出功率成为输入功率的一半时(即-3dB)，最高频率和最低频率间的差值就代表了系统的通频带宽，其单位为赫兹(Hz)。

2. 数字设备中：表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”/单位时间内通过链路的数量，常用来表示网络的通信线路所能传输数据的能力。单位是比特每秒(bps)。

## 1.2 奈奎斯特定理与香农定理

发送信号波形收到现实中的信道（带宽受限、有噪声、干扰）而接收端无法识别的现象称为失真

影响失真程度的因素： 

1. 码元传输速率
2. 信号传输距离
3. 噪声干扰
4. 传输媒体质量

信道带宽是信道能通过的最高频率和最低频率之差。如下图信道带宽=3300Hz-300Hz=3000Hz

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-22df5a3d8de0a942.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

码间串扰：失真的一种现象，即接收端收到的信号波形失去了码元之间清晰界限的现象。

### 1.2.1 奈奎斯特定理

奈氏准则：**在理想低通（无噪声，带宽受限）条件下**，为了避免码间串扰，**极限码元传输速率**为2W Baud，W是信道带宽，单位是Hz。若用V标识每个码元离散电平的数目，则极限数据率为

理想低通信道下的极限数据传输率=2Wlog_2V（b/s）

根据奈氏准则，可以得到以下结论：

1. 在任何信道中，码元传输的速率是有上限的。若传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的完全正确识别成为不可能。
2. 信道的频带越宽（即能通过的信号高频分量越多），就可以用更高的速率进行码元的有效传输。
3. 奈氏准则给出了码元传输速率的限制，但并没有对信息传输速率给出限制。
4. 由于码元的传输速率受奈氏准则的制约，所以要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量，这就需要采用多元制的调制方法。

### 1.2.2 香农定理

噪声存在于所有的电子设备和通信信道中。由于噪声随机产生，它的瞬时值有时会很大，因此噪声会使接收端对码元的判决产生错误。但是噪声的影响是相对的，若信号较强，那么噪声影响相对较小。因此，信噪比就很重要。

信噪比=信号的平均功率/噪声的平均功率，常记为S/N，并用分贝（dB）作为度量单位，即：

信噪比（dB）=10log_{10}(S/N)

香农定理：**在带宽受限且有噪声的信道中**，为了不产生误差，**信息的数据传输速率有上限值**。

信道的极限数据传输速率=Wlog_2(1+S/N)（b/s）

对于香农定理，有以下结论：

1. 信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高。
2. 对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了。
3. 只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现无差错的传输。
4. 香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少。
5. 从香农定理可以看出，若信道带宽W或信噪比S/N没有上限（不可能），那么信道的极限信息传输速率也就没有上限。

## 1.3 编码和调制

信道上传送的信号可以分为基带信号和宽带信号

- 基带信号：将数字信号1和0直接用两种不同的电压表示，再送到数字信道上去传输（基带传输）。来自信源的信号，像计算机输出的代表各种文字或图像文件的数据信号都属于基带信号。基带信号就是发出的直接表达了要传输的信息的信号，比如我们说话的声波就是基带信号。
- 宽带信号：将基带信号进行调制后形成的频分复用模拟信号，再传送到模拟信道上去传输（宽带传输）。把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输（即仅在一段频率范围内能够通过信道）。

在传输距离较近时，计算机网络采用基带传输方式（近距离衰减小，从而信号内容不易发生变化）

在传输距离较远时，计算机网络采用宽带传输方式（远距离衰减大，即使信号变化大也能最后过滤出来基带信号）

### 1.3.1 数字数据编码为数字信号

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-07ef4c359e637b8b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1. 归零编码：在归零编码(RZ)中用高电平代表1、低电平代表0(或者相反)，每个时钟周期的中间均跳变到低电平（归零)，接收方根据该跳变调整本方的时钟基准，这就为传输双方提供了自同步机制。由于归零需要占用一部分带宽，因此传输效率受到了一定的影响。
2. 非归零编码(NRZ)与RZ编码的区别是不用归零，一个周期可以全部用来传输数据。但NRZ编码无法传递时钟信号，双方难以同步，因此若想传输高速同步数据，则需要都带有时钟线。
3. 反向非归零编码：反向非归零编码（NRZI)与NRZ编码的区别是用信号的翻转代表0、信号保持不变代表1。翻转的信号本身可以作为一种通知机制。这种编码方式集成了前两种编码的优点，既能传输时钟信号，又能尽量不损失系统带宽。USB 2.0通信的编码方式就是NRZI编码。
4. 曼彻斯特编码：将一个码元分成两个相等的间隔，前一个间隔为低电平后一个间隔为高电平表示码元1；码元0则正好相反。也可以采用相反的规定。该编码的特点是在每一个码元的中间出现电平跳变，位中间的跳变既作时钟信号（可用于同步），又作数据信号，但它所占的频带宽度是原始的基带宽度的两倍。每一个码元都被调成两个电平，所以数据传输速率只有调制速率的1/2。
5. 差分曼彻斯特编码：常用于局域网传输，其规则是：若码元为1，则前半个码元的电平与上一个码元的后半个码元的电平相同，若为0，则相反。该编码的特点是，在每个码元的中间，都有一次电平的跳转，可以实现自同步，且抗干扰性强于曼彻斯特编码
6. 4B/5B编码：比特流中插入额外的比特以打破一连串的0或1，就是用5个比特来编码4个比特的数据，之后再传给接收方，因此称为4B/5B。编码效率为80%。只采用16种对应16种不同的4位码，其他的16种作为控制码（帧的开始和结束，线路的状态信息等）或保留。

### 1.3.2 数字数据调制为模拟信号

数字数据调制技术在发送端将数字信号转换为模拟信号，而在接收端将模拟信号还原为数字信号，分别对应于调制解调器的调制和解调过程。

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-c1d9f4290ae8d24b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

调幅+调相（QAM）

> 某通信链路的波特率是1200Baud，采用4个相位，每个相位有4种振幅的QAM调制技术，则该链路的信息传输速率是多少？

### 1.3.3 模拟数据编码为数字信号

计算机内部处理的是二进制数据，处理的都是数字音频，所以需要将模拟音频通过采样、量化转换成有限个数字表示的离散序列（即实现音频数字化）。最典型的例子就是对音频信号进行编码的脉码调制（PCM），在计算机应用中，能够达到最高保真水平的就是PCM编码，被广泛用于素材保存及音乐欣赏，CD、DVD以及我们常见的WAV文件中均有应用。它主要包括三步：抽样、量化、编码。

- 抽样：对模拟信号周期性扫描，把时间上连续的信号变成时间上离散的信号。为了使所得的离散信号能无失真地代表被抽样的模拟数据，要使用采样定理进行采样：$f_{采样频率}≥ 2f_{信号最高频率}$
- 量化： 把抽样取得的电平幅值按照一定的分级标度转化为对应的数字值，并取整数，这就把连续的电平幅值转换为离散的数字量。
- 编码：把量化的结果转换为与之对应的二进制编码。

### 1.3.4 模拟数据调制为模拟信号

为了实现传输的有效性，可能需要较高的频率。这种调制方式还可以使用频分复用技术，充分利用带宽资源。在电话机和本地交换机所传输的信号是采用模拟信号传输模拟数据的方式；模拟的声音数据是加载到模拟的载波信号中传输的。

## 1.4 数据交换方式

### 1.4.1 电路交换(Circuit Exchanging)

电路交换：在数据传输期间，源结点与目的结点之间有一条由中间结点构成的专用物理连接线路，在数据传输结束之前，这条线路一直保持。因此，电路交换技术分为三个阶段：连接建立、数据传输和连接释放。特点：独占资源，用户始终占用端到端的固定传输带宽。适用于远程批处理信息传输或系统间实时性要求高的大量数据传输的情况。

电路交换优点：

- 传输时延小
- 数据顺序传送，无失序问题
- 实时性强，双方一旦建立物理通路，便可以实时通信，适用于交互式会话类通信。
- 全双工通信，没有冲突，通信双方有不同的信道，不会争用物理信道
- 适用于模拟信号和数字信号
- 控制简单，电路的交换设备及控制较简单

电路交换缺点：

- 建立连接时间长
- 线路独占，即使通信线路空闲，也不能供其他用户使用，信道使用效率低。
- 灵活性差，双方连接通路中的任何一点出了故障，必须重新拨号建立新连接，不适应突发性通信。
- 无数据存储能力，难以平滑通信量。
- 电路交换时，数据直达，不同类型、不同规格、不同速率的终端很难相互进行通信
- 无法发现与纠正传输差错，难以在通信过程中进行差错控制。

### 1.4.2 报文交换(Message Exchanging)

报文：报文(message)是网络中交换与传输的数据单元，即站点一次性要发送的数据块。报文包含了将要发送的完整的数据信息，其长短很不一致，长度不限且可变。报文交换无需在两个站点之间建立一条专用通路，其数据传输的单位是报文，传送过程采用**存储转发**方式。

报文交换优点：

- 无需建立连接，无建立连接时延，用户可随时发送报文。
- 动态分配线路，动态选择报文通过的最佳路径，可以平滑通信量。
- 提高线路可靠性，某条传输路径发生故障，可重新选择另一条路径传输。
- 提高线路利用率，通信双方在不同的时间一段一段地部分占有这条物理通道，多个报文可共享信道。
- 提供多目标服务：一个报文可同时发往多个目的地址。
- 在存储转发中容易实现代码转换和速率匹配，甚至收发双方可以不同时处于可用状态。这样就便于类型、规格和速度不同的计算机之间进行通信。

报文交换缺点：

- 实时性差，不适合传送实时或交互式业务的数据。数据进入交换结点后要经历存储转发过程，从而引起转发时延。
- 只适用于数字信号。
- 由于报文长度没有限制，而每个中间结点都要完整地接收传来的整个报文，当输出线路不空闲时，还可能要存储几个完整报文等待转发，要求网络中每个结点有较大的缓冲区。为了降低成本，减少结点的缓冲存储器的容量，有时要把等待转发的报文存在磁盘上，进一步增加了传送时延。

### 1.4.3 分组交换(Packet Exchanging)

分组：大多数计算机网络都不能连续地传送任意长的数据，所以实际上网络系统把数据分割成小块，然后逐块地发送，这种小块就称作分组（packet）。分组交换与报文交换的工作方式基本相同，都采用存储转发方式，形式上的主要差别在于，**分组交换网中要限制所传输的数据单位的长度**，一般选128B。发送节点首先对从终端设备送来的数据报文进行接收、存储，而后将报文划分成一定长度的分组，并以分组为单位进行传输和交换。接收结点将收到的分组组装成信息或报文。

分组交换优点：

- 无建立时延，无需为通信双方预先建立一条专用通信线路，用户可随时发送分组。
- 线路利用率高，通信双方在不同的时间一段一段地部分占有这条物理通道，多个分组可共享信道。
- 简化了存储管理。因为分组的长度固定，相应的缓冲区的大小也固定，在交换结点中存储器的管理通常被简化为对缓冲区的管理，相对比较容易。
- 加速传输，后一个分组的存储可以和前一个分组的转发并行操作；传输一个分组比一份报文所需缓冲区小，减少等待发送时间。
- 减少出错几率和重发数据量，提高可靠性，减少传输时延。
- 分组短小，适用于计算机之间突发式数据通信。

分组交换缺点：

- 尽管分组交换比报文交换的传输时延少，但仍存在存储转发时延，而且其结点交换机必须具有更强的处理能力。
- 每个分组都要加控制信息，一定程度上降低了通信效率，增加了处理的时间。
- 当分组交换采用数据报服务时，可能出现失序、丢失或重复分组，分组到达目的结点时，要对分组按编号进行排序等工作，增加了麻烦。若采用虚电路服务，虽无失序问题，但有呼叫建立、数据传输和虚电路释放三个过程。

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-379a3a2edba2b7ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1. 传送数据量大，且传送时间远大于呼叫时，选择电路交换。电路交换传输时延最小。
2. 当端到端的通路有很多段的链路组成时，采用分组交换传送数据较为合适。
3. 从信道利用率上看，报文交换和分组交换优于电路交换，其中分组交换比报文交换的时延小，尤其适合于计算机之间的突发式的数据通信。

## 1.5 数据报与虚电路

### 1.5.1 数据报方式

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-1a490c7d331f07cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1. 源主机（A）将报文分成多个分组，依次发送到直接相连的结点（A）。
2. 结点A收到分组后，对每个分组差错检测和路由选择，不同分组的下一跳结点可能不同。
3. 结点C收到分组P1后，对分组P1进行差错检测，若正确则向A发送确认信息，A收到C确认后则丢弃分组P1副本。
4. 所有分组到达主机B

数据报方式的特点：

- 数据报方式为网络层提供无连接服务[^1]。发送方可随时发送分组，网络中的结点可随时接收分组。
- 同一报文的不同分组达到目的结点时可能发生乱序、重复与丢失。
- 每个分组在传输过程中都必须携带源地址和目的地址，以及分组号。
- 分组在交换结点存储转发时，需要排队等候处理，这会带来一定的时延。当通过交换结点的通信量较大或网络发生拥塞时，这种时延会大大增加，交换结点还可根据情况丢弃部分分组。
- 网络具有冗余路径，当某一交换结点或一段链路出现故障时，可相应地更新转发表，寻找另一条路径转发分组，对故障的适应能力强，适用于突发性通信，不适于长报文、会话式通信。

### 1.5.2 虚电路方式

虚电路：一条源主机到目的主机类似于电路的路径（逻辑连接），路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表，每一项记录了一个打开的虚电路的信息。与电路交换类似，整个通信过程分为三个阶段：虚电路建立、数据传输和虚电路释放

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-bdf0b6c17a86e7bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

1. 虚电路建立：源主机发送“呼叫请求”分组并收到“呼叫应答”分组后才算建立连接。
2. 数据传输：每个分组携带虚电路号，分组号、检验和等控制信息。
3. 虚电路释放：源主机发送“释放请求”分组以拆除虚电路。

虚电路方式的特点：

- 虚电路方式为网络层提供连接服务[^2]。源节点与目的结点之间建立一条逻辑连接，而非实际物理连接。
- 一次通信的所有分组都通过虚电路顺序传送，分组不需携带源地址、目的地址等信息，包含虚电路号，相对数据报方式开销小，同一报文的不同分组到达目的结点时不会乱序、重复或丢失。
- 分组通过虚电路上的每个节点时，节点只进行差错检测，不需进行路由选择。
- 每个节点可能与多个节点之间建立多条虚电路，每条虚电路支持特定的两个端系统之间的数据传输，可以对两个数据端点的流量进行控制，两个端系统之间也可以有多条虚电路为不同的进程服务。
- 致命弱点：当网络中的某个结点或某条链路出故障而彻底失效时，则所有经过该结点或该链路的虚电路将遭到破坏

![图片.png](https://upload-images.jianshu.io/upload_images/26868451-df9c3329397816c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)